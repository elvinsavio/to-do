package views

import (
	Icon "elvinsavio/todo/views/icons"
	types "elvinsavio/todo/types"
	Base "elvinsavio/todo/views/pages/base"
	"time"
	"fmt"
)

script convertDateToStringRelative(date time.Time, id string) {
	let tmp = document.getElementById(id)
	const oneMonthAgo = dateFns.subMonths(new Date(), 1);
	const isOlderThanMonth =  dateFns.isBefore(date, oneMonthAgo);
	if(isOlderThanMonth){
	tmp.innerHTML = "more than a month"
	}else{
	tmp.innerHTML =  dateFns.formatRelative(date, new Date());
	}
}

script convertDateToString(date time.Time, id string) {
	let tmp = document.getElementById(id)
	tmp.innerHTML =  dateFns.format(date, "yyyy-MM-dd");
}

templ ProjectsPage(projects []types.ProjectList) {
	@Base.BaseTemplate() {
		<div class="h-screen flex justify-center items-center">
			<div class="relative border border-border rounded m-2">
				<table>
					<thead>
						<tr>
							<th>Name</th>
							<th>Last Opened</th>
							<th>Created At</th>
							<th></th>
						</tr>
					</thead>
					<tbody>
						for id, item := range projects {
							<tr>
								<td>
									<a href={ "project/" + templ.SafeURL(item.Name) } class="truncate">{ item.Name }</a>
								</td>
								<td class="text-sm" id={ "last-opened-" + fmt.Sprintf("%v", id) }>
									@convertDateToStringRelative(item.LastOpened, "last-opened-"+fmt.Sprintf("%v", id))
								</td>
								<td class="text-sm" id={ "created-at-" + fmt.Sprintf("%v", id) }>
									@convertDateToString(item.CreatedAt, "created-at-"+fmt.Sprintf("%v", id))
								</td>
								<td class="text-left" dir="rtl">
									<button class="icon-button group">
										@Icon.IconDelete()
									</button>
								</td>
							</tr>
						}
					</tbody>
				</table>
			</div>
		</div>
		<div class="landing-image"></div>
	}
}
